---
title: "lef_project"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)

library(tidyverse)
library(here)
library(janitor)
library(lubridate)
library(patchwork)

```

Code below reads in and assigns multiple CSV files
```{r}
# create a list of file names to read in

lef_files <- list.files(here("data"), pattern = "*.csv")

# loop over the files, reading in, and creating a stored object with assign
for (i in seq_along(lef_files)) {
    assign(lef_files[i] %>%
             str_remove(".csv"),
           read_csv(here("data", lef_files[i]), na = c("-9999","-9999.0","-9999.00")))
}
```


Cleaning BQ1 : Julia
```{r}
bq1 <- `QuebradaCuenca1-Bisley` %>% 
  clean_names() %>% 
  mutate(sample_date = lubridate::mdy(sample_date)) %>% 
  mutate(year = year(sample_date)) %>% 
  mutate(month = month(sample_date)) %>% 
  select(-sample_time)
```



Cleaning BQ2: Scout
```{r}
#created a new df called "bq2"
#separated the sample date column into sample dates and sample times for ease of wrangling the dates, which are of more importance 
#used lubridate to change `sample_date` data to mdy format
#added a year column using sample_date
#added a month column using sample_date

bq2 <- `QuebradaCuenca2-Bisley` %>% 
  clean_names() %>% 
  separate(col = sample_date, into = c("sample_date", "sample_time"), sep = " ") %>% 
  mutate(sample_date = lubridate::mdy(sample_date)) %>% 
  mutate(year = year(sample_date)) %>% 
  mutate(month = month(sample_date)) %>% 
  select(-sample_time)

```


Cleaning BQ3: Marie
```{r}
# cleaning data for BQ3
bq3 <- `QuebradaCuenca3-Bisley` %>% 
  clean_names() %>% 
  mutate(sample_date = lubridate::mdy(sample_date)) %>% 
  mutate(year = year(sample_date)) %>% 
  mutate(month = month(sample_date)) %>% 
  select(-sample_time)
```

Cleaning PRM: Steven
```{r}
prm <- RioMameyesPuenteRoto %>% 
  
  # clean name headings
  clean_names() %>% 
  
  # changed date "character" to "datetime"
  mutate(sample_date = lubridate::mdy(sample_date)) %>% 
  
  # separate out month and year
  mutate(year = year(sample_date)) %>% 
  mutate(month = month(sample_date)) %>% 
  select(-sample_time)
  
  # group by
  #group_by(sample_date, year, month) %>% 
  #summarize(k, no3)
  
  # select columns three columns
  # no3 in ug N/L
  # K in ug N/L
  
  # select("sample_date", "date", "year, "no3", "k")
prm
```
Combining Datasets: Marie
```{r}
all_sites <- bind_rows(prm, bq1, bq2, bq3) %>% 
  group_by(sample_id)
```

Visualizing All Sites: Scout

```{r}
all_sites_k <- ggplot(data = all_sites, aes(x = sample_date, y = k)) +
  geom_line(aes(linetype = sample_id),
            size = 0.25,
            show.legend = FALSE) +
  geom_vline(xintercept = as.numeric(as.Date("1989-09-21")), color = "blue", size = 1) +
  labs(title = "Impact of Hurricane Hugo on Stream Chemistry",
       subtitle = "Difference in Potassium and Nitrate at Stream Sites in the Luquillo Experimental Forest",
       x = NULL,
       y = expression(paste("k mg ", l^{-1}))) +
  scale_x_date(position = "top")

all_sites_k 

all_sites_no3 <- ggplot(data = all_sites, aes(x = sample_date, y = no3)) +
  geom_line(aes(linetype = sample_id),
            size = 0.25,
            show.legend = TRUE) +
  geom_vline(xintercept = as.numeric(as.Date("1989-09-21")), color = "blue", size = 1) +
  labs(x = NULL,
       y = expression(paste(NO[3]," ", "-N ", ug, l^{-1})),
       caption = "McDowell, W. 2021. Chemistry of stream water from the Luquillo Mountains ver 4923052. Environmental Data Initiative.") +
  theme(axis.text.x = element_blank())
  

all_sites_no3

```


```{r}
(all_sites_k / all_sites_no3) &
  theme_minimal() +
  theme(legend.position = c(0.9, 0.6),
        legend.background = element_blank(),
        legend.key.size = unit(0.1, 'cm'), 
        legend.title = element_blank(),
        )
```

